!function(e){"use strict";var t={};t.height=e.select(".graph").style("height"),t.width=e.select(".graph").style("width"),t.selectedCountry="",t.selectedCompany=void 0,t.showingCompany=void 0,t.svg=e.selectAll(".graph").append("svg").classed("main",!0).attr("width",t.width).attr("height",t.height),t.graphTitle=t.svg.append("text").classed("title",!0).attr("y",20).text("Europeese banken gebruiken €65 miljard in spaarcenten om te investeren in deze bedrijven."),t.countries=t.svg.append("g").classed("countries",!0),t.barchart=t.svg.append("g").classed("barchart",!0),t.countryText=t.svg.append("text").classed("country-text",!0),t.bankBreakdown=e.select(".company-overview").append("svg"),t.cleanUpData=function(e,t,n){var a={countries:[],runningTotal:0,dirtyCompanies:n};t.sort(function(e,t){return e.Country>t.Country?1:-1}),t.forEach(function(e){var t;a.countries.forEach(function(n){n.name===e.Country&&(t=n,t.investors.push({name:e.Investor}))}),t||(t={name:e.Country,investors:[{name:e.Investor}]},a.countries.push(t))});var s=[],r=0;return e.forEach(function(e){if(""!==e.Parent){var t={name:e.Parent,investments:[],value:0};$.each(e,function(e,n){n=parseFloat(n),n&&"Total"!==e&&(t.investments.push({name:e,value:n}),t.value+=n)}),s.push(t),r=s.length-1}else $.each(e,function(e,t){if(t=parseFloat(t),t&&"Total"!==e){var n=!1;s[r].investments.forEach(function(a){e===a.name&&(n=!0,a.value+=t,s[r].value+=t)}),n||(s[s.length-1].investments.push({name:e,value:t}),s[s.length-1].value+=t)}})}),a.investors=s,a},t.drawBarGraphs=function(n){var a,s,r,o;o=e.max(t.cleanedData.investors,function(e){return e.value}),r=e.scale.linear().domain([0,o]).rangeRound([0,400]),a=t.barchart.selectAll("g.investor").data(t.cleanedData.investors,function(e){return e.name}),s=a.enter().append("g").classed("investor",!0).attr("transform",function(e,t){var n=70+50*t;return"translate(140, "+n+")"}).attr("actual-value",function(e){return e.total}),s.append("text").text(function(e){return e.name}).each(function(e){e.name===n&&t.showInvestmentsBreakdown(e,this)}).attr("y",14).attr("x",-5).classed("bank-name",!0).on("click",function(e){t.showInvestmentsBreakdown(e,this)}),s.append("text").attr("x",function(e){return r(e.value)+30}).attr("y",14).text(function(e){return"€"+Math.round(e.value)+" mln"}),s.selectAll("g.investments").data(function(e){return e.investments}).enter().append("g").classed("investment",!0).attr("actual-value",function(e){return e.value}).append("rect").attr("fill",function(e){return t.companyColors(e.name)}).attr("y",0).attr("height",20).attr("x",0).attr("width",0).on("mouseover",function(n){""!==e.select(".company-overview .text").html()||t.bankSelected||e.select(".company-overview h2").html(n.name),t.addClassToSelected(n,"g.investment","hovering",!0)}).on("mouseout",function(n){""!==e.select(".company-overview .text").html()||t.bankSelected||e.select(".company-overview h2").html(""),t.addClassToSelected(n,"g.investment","hovering",!1)}).on("click",t.clickOnCompany).transition().duration(500).attr("x",function(t,n){var a=e.select(this.parentNode.parentNode).data()[0].investments;if(0===n)return t.boostX=r(t.value)+1,r(0);var s=a[n-1].boostX+1;return t.boostX=r(t.value)+s,a[n-1].boostX}).attr("width",function(e){return r(e.value)}),a.exit().remove()},t.clickOnCompany=function(n){e.select(".company-overview svg").html(""),e.select(".company-overview h2").html(n.name),e.selectAll(".bank-name").classed("selected",!1),e.selectAll("g.investment").classed("selected",!1).classed("clicked",!1),e.select(this).classed("clicked",!0),e.selectAll("g.investment").filter(function(e){return e.name===n.name}).classed("selected",!0),e.select(".company-overview h2").html(n.name);var a=t.dirtyCompanies.filter(function(e){return e.name===n.name});e.select(".company-overview .text").html(a[0].description)},t.showInvestmentsBreakdown=function(n,a){e.selectAll("g.investment").classed("selected",!1).classed("clicked",!1),t.bankSelected=!0,e.selectAll(".bank-name").classed("selected",!1),e.select(a).classed("selected",!0),e.selectAll("g.investment").classed("clicked",!1),e.select(".company-overview h2").html(n.name),e.select(".company-overview .text").html("");var s=e.max(n.investments,function(e){return e.value}),r=e.scale.linear().domain([0,s]).rangeRound([0,300]),o=e.select(".company-overview svg").attr("width","400").attr("height","500"),l=o.selectAll("g").data(n.investments,function(e){return e.name});l.each(function(e,t){console.log(e,t)}).select("rect").transition().attr("width",function(e){return r(e.value)}).attr("y",function(e,t){return 20*t+15}),l.select("text").transition().attr("y",function(e,t){return 20*t+15});var c=l.enter().append("g").classed("investment",!0).on("mouseover",function(n){e.select(this).select("text").text(function(){return n.name+" - €"+t.commaSeparateNumber(Math.round(n.value))+" mln"})}).on("mouseout",function(t){e.select(this).select("text").text(function(){return t.name})}).on("click",t.clickOnCompany);c.append("rect").attr("x",0).attr("height",5).attr("y",function(e,t){return 20*t+15}).attr("width",function(e){return r(e.value)}).attr("fill",function(e){return t.companyColors(e.name)}),c.append("text").attr("x",0).attr("y",function(e,t){return 20*t+15}).text(function(e){return e.name}),l.exit().remove()},t.addClassToSelected=function(t,n,a,s){e.selectAll(n).filter(function(e){return e.name===t.name}).classed(a,s)},t.commaSeparateNumber=function(e){for(;/(\d+)(\d{3})/.test(e.toString());)e=e.toString().replace(/(\d+)(\d{3})/,"$1,$2");return e};var n=function(){var e=$(window).scrollTop(),t=$("#notification-anchor").offset().top,n=$("#notification");n.css(e>t?{position:"fixed",top:"40px",right:$(".graph")[0].offsetLeft}:{position:"absolute",top:"",right:""})};$(window).scroll(n),n(),e.csv("scripts/vendor/investments.csv",function(n){e.json("scripts/vendor/descriptions.json",function(a){e.csv("scripts/vendor/countries.csv",function(s){t.cleanedData=t.cleanUpData(n,s),t.dirtyCompanies=a,t.xScale=e.scale.linear().domain([0,t.cleanedData.total]).rangeRound([0,parseInt(t.width)-0]);var r=t.cleanedData.countries.map(function(e){return e.name}),o=a.map(function(e){return e.name});t.companyColors=e.scale.ordinal().domain(o).range(["hsl(150, 100%, 25%)","hsl(155, 100%, 30%)","hsl(155, 100%, 35%)","hsl(160, 100%, 40%)","hsl(160, 100%, 45%)","hsl(160, 100%, 50%)","hsl(165, 100%, 55%)","hsl(165, 100%, 25%)","hsl(165, 100%, 30%)","hsl(170, 100%, 35%)","hsl(170, 100%, 40%)","hsl(170, 100%, 45%)","hsl(175, 100%, 50%)","hsl(175, 100%, 55%)","hsl(175, 100%, 25%)","hsl(180, 100%, 30%)","hsl(180, 100%, 35%)","hsl(180, 100%, 40%)","hsl(185, 100%, 45%)","hsl(185, 100%, 50%)","hsl(185, 100%, 55%)"]),t.colorScale=e.scale.ordinal().domain(r).range(["hsl(330, 100%, 35%)","hsl(330, 100%, 40%)","hsl(330, 100%, 45%)","hsl(330, 100%, 50%)","hsl(330, 100%, 55%)","hsl(330, 100%, 60%)","hsl(330, 100%, 65%)"]),t.drawBarGraphs("Allianz SE")})})})}(d3);